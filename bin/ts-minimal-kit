#!/bin/bash

# ts-minimal-kit installer
# Usage: ts-minimal-kit <project-name>

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ
ERROR_MSG="‚ùå Closing because of error"

if [ -z "$1" ]; then
    echo "Usage: ts-minimal-kit <project-name>"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ -d "$1" ]; then
    echo "‚ùå Directory '$1' already exists"
    exit 1
fi

echo "üöÄ Installing ts-minimal-kit as '$1'..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ git clone
git clone https://github.com/k1de/ts-minimal-kit.git "$1" || {
    echo "$ERROR_MSG: git"
    exit 1
}

cd "$1" || {
    echo "$ERROR_MSG: cd" 
    exit 1
}

echo "üßπ Removing git history..."
npm run degit || {
    echo "$ERROR_MSG: npm"
    exit 1
}

echo "üìù Setting project name & version..."
npm pkg set name="$1" && npm version 0.0.0 || {
    echo "$ERROR_MSG: npm"
    exit 1
}

echo "üîß Initializing new repository..."
git init || {
    echo "$ERROR_MSG: git"
    exit 1
}

echo "üì¶ Installing dependencies..."
npm install || {
    echo "$ERROR_MSG: npm"
    exit 1
}

echo "‚¨ÜÔ∏è Updating TypeScript to latest..."
npm install -D typescript@latest @types/node@latest || {
    echo "$ERROR_MSG: npm"
    exit 1
}

echo "üéâ Done! Opening in VS Code..."
code . || echo "VS Code not found."

echo ""
echo "‚úÖ Project '$1' is ready!"